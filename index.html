<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Start Page</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Rock Salt:wght@400&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <h1 id="greeting">STAY FOCUSED ASSHOLE!</h1>

        <form action="https://www.google.com/search" method="GET" class="search-box">
            <input type="text" name="q" placeholder="Let's find it..." autocomplete="off" autofocus>
        </form>

        <!--  The Slider Navigation -->
        <nav class="shortcut-slider" id="slider">
        <!-- Dynamic items will appear here -->
        
            <!-- The 'Add' Button is hardcoded at the end -->
            <div class="shortcut-item add-btn" onclick="openModal()">
                <div class="icon-circle">+</div>
                <span>Add</span>
            </div>
            <!-- End of Addbutton section -->
        </nav>
        <!-- End of The Slider Navigation section -->

        
    </div>

    <!--  The Modal (Hidden Form) -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <h4>Add New Shortcut</h4>
            <input type="text" id="inputLabel" placeholder="Name (e.g. Google)">
            <input type="url" id="inputUrl" placeholder="URL (e.g. https://google.com)">
             <!-- Additions start here -->
            <label for="iconUpload">Custom Icon Upload (Optional):</label>
            <input type="file" id="iconUpload" accept="image/*">
            <small>If no file is chosen, we'll try to find the website's favicon.</small>
  <!-- Additions end here -->
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeModal()">Cancel</button>
                <button class="save-btn" onclick="saveShortcut()">Save</button>
            </div>
        </div>
    </div>
    <!--  End of Modal -->
    
    <!--  JavaScript Logic -->
    <script>
        // Load saved shortcuts on page load
        document.addEventListener('DOMContentLoaded', loadShortcuts);
        
        // Google's free API service to fetch favicons
        const FAVICON_API = 'https://www.google.com/s2/favicons?domain=';
        
        function loadShortcuts() {
            const shortcuts = JSON.parse(localStorage.getItem('myShortcuts')) || [];
            const slider = document.getElementById('slider');
            const addButton = document.querySelector('.add-btn');
        
            shortcuts.forEach(shortcut => {
                // We now pass the icon data/URL to the creation function
                createShortcutElement(shortcut.label, shortcut.url, shortcut.icon, slider, addButton);
            });
        }
        
        function saveShortcut() {
            const label = document.getElementById('inputLabel').value;
            let url = document.getElementById('inputUrl').value;
            const iconFile = document.getElementById('iconUpload').files[0];
        
            if (!label || !url) return alert("Please fill in both name and URL");
            if (!url.startsWith('http')) url = 'https://' + url;
            
            // Use FileReader to convert uploaded image to a Data URL string
            if (iconFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Icon = e.target.result;
                    finalizeShortcutSave(label, url, base64Icon);
                };
                reader.readAsDataURL(iconFile); // Read the file as a Base64 URL
            } else {
                // If no file uploaded, try to grab the default favicon
                const domain = new URL(url).hostname;
                // We use Google's API to reliably fetch the favicon URL
                const faviconUrl = `${FAVICON_API}${encodeURIComponent(domain)}&sz=64`;
                finalizeShortcutSave(label, url, faviconUrl);
            }
        }
        
        function finalizeShortcutSave(label, url, iconData) {
            // 1. Save to Local Storage
            const shortcuts = JSON.parse(localStorage.getItem('myShortcuts')) || [];
            shortcuts.push({ label, url, icon: iconData }); // Save the icon data/URL
            localStorage.setItem('myShortcuts', JSON.stringify(shortcuts));
        
            // 2. Add to DOM
            const slider = document.getElementById('slider');
            const addButton = document.querySelector('.add-btn');
            createShortcutElement(label, url, iconData, slider, addButton);
        
            // 3. Cleanup
            closeModal();
            document.getElementById('inputLabel').value = '';
            document.getElementById('inputUrl').value = '';
            document.getElementById('iconUpload').value = ''; // Clear file input
        }
        
        
        function createShortcutElement(label, url, iconData, container, insertBeforeNode) {
            const a = document.createElement('a');
            a.href = url;
            a.className = 'shortcut-item';
        
            let iconContent;
            if (iconData.startsWith('data:image') || iconData.startsWith('http')) {
                // If it's a Base64 string or URL, use an <img> tag
                iconContent = `<img src="${iconData}" alt="${label} icon">`;
            } else {
                // Fallback to the first letter if somehow icon data is missing/invalid
                iconContent = `<span>${label.charAt(0).toUpperCase()}</span>`;
            }
        
            a.innerHTML = `
                <div class="icon-circle">
                ${iconContent} 
                </div>
                <span>${label}</span>
            `;
        
            container.insertBefore(a, insertBeforeNode);
        }
        
        // Modal Controls (No changes needed here)
        function openModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }
    </script>    
    <!-- End of JavaScript Logic -->
        
</body>
</html>
